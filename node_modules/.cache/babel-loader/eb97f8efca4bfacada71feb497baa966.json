{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { reactive, toRefs, onMounted } from 'vue';\nimport axios from 'axios';\nimport Header from '../userLayout/Header/header.vue';\nimport { ElTabs, ElTabPane, ElForm, ElFormItem, ElInput, ElButton, ElCard, ElMessage } from 'element-plus';\nexport default {\n  name: 'PersonalCenter',\n  components: {\n    Header,\n    ElTabs,\n    ElTabPane,\n    ElForm,\n    ElFormItem,\n    ElInput,\n    ElButton,\n    ElCard\n  },\n\n  setup() {\n    const state = reactive({\n      username: \"\",\n      userInfo: {\n        username: \"\",\n        address: \"\",\n        telephone: \"\"\n      },\n      rules: {\n        address: [{\n          required: true,\n          message: '请输入地址',\n          trigger: 'blur'\n        }],\n        telephone: [{\n          required: true,\n          message: '请输入电话号码',\n          trigger: 'blur'\n        }]\n      },\n      activeTab: \"basic-info\",\n      passwordForm: {\n        oldPassword: \"\",\n        newPassword: \"\",\n        confirmPassword: \"\"\n      },\n      passwordRules: {\n        oldPassword: [{\n          required: true,\n          message: '请输入旧密码',\n          trigger: 'blur'\n        }],\n        newPassword: [{\n          required: true,\n          message: '请输入新密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 20,\n          message: '密码长度为6-20个字符',\n          trigger: 'blur'\n        }],\n        confirmPassword: [{\n          required: true,\n          message: '请确认新密码',\n          trigger: 'blur'\n        }, {\n          validator: (rule, value, callback) => {\n            if (value !== state.passwordForm.newPassword) {\n              callback(new Error('两次密码输入不一致'));\n            } else {\n              callback();\n            }\n          },\n          trigger: 'blur'\n        }]\n      }\n    });\n\n    const initUserInfo = async () => {\n      try {\n        const response = await axios.get(\"/profile\");\n        const data = response.data;\n        state.userInfo.username = data.username;\n        state.username = data.username;\n        state.userInfo.address = data.address;\n        state.userInfo.telephone = data.telephone;\n      } catch (err) {\n        console.log(err);\n      }\n    };\n\n    onMounted(() => {\n      initUserInfo();\n    }); // 更新用户信息方法\n\n    const updateUserInfo = () => {\n      const form = state.$refs.userInfoForm;\n      form.validate(async valid => {\n        if (valid) {\n          try {\n            const response = await axios.put(\"/updateUserInfo\", state.userInfo);\n            console.log(response);\n            ElMessage.success('修改成功');\n          } catch (error) {\n            ElMessage.error('修改失败：' + error.message);\n          }\n        }\n      });\n    }; // 修改密码方法\n\n\n    const changePassword = () => {\n      const form = state.$refs.passwordForm;\n      form.validate(async valid => {\n        if (valid) {\n          try {\n            const response = await axios.post(\"/changePassword\", state.passwordForm);\n            console.log(response);\n            ElMessage.success('修改成功');\n          } catch (error) {\n            ElMessage.error('修改失败：' + error.message);\n          }\n        }\n      });\n    };\n\n    return { ...toRefs(state),\n      updateUserInfo,\n      changePassword\n    };\n  }\n\n};","map":{"version":3,"mappings":";AAkDI,SAASA,QAAT,EAAmBC,MAAnB,EAA2BC,SAA3B,QAA4C,KAA5C;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,iCAAnB;AACA,SAASC,MAAT,EAAiBC,SAAjB,EAA4BC,MAA5B,EAAoCC,UAApC,EAAgDC,OAAhD,EAAyDC,QAAzD,EAAmEC,MAAnE,EAA2EC,SAA3E,QAA4F,cAA5F;AAEA,eAAe;AACfC,MAAI,EAAE,gBADS;AAEfC,YAAU,EAAE;AACZV,UADY;AAEZC,UAFY;AAGZC,aAHY;AAIZC,UAJY;AAKZC,cALY;AAMZC,WANY;AAOZC,YAPY;AAQZC;AARY,GAFG;;AAYfI,OAAK,GAAG;AACR,UAAMC,KAAI,GAAIhB,QAAQ,CAAC;AACvBiB,cAAQ,EAAE,EADa;AAEvBC,cAAQ,EAAE;AACVD,gBAAQ,EAAE,EADA;AAEVE,eAAO,EAAE,EAFC;AAGVC,iBAAS,EAAE;AAHD,OAFa;AAOvBC,WAAK,EAAE;AACPF,eAAO,EAAE,CACT;AAAEG,kBAAQ,EAAE,IAAZ;AAAkBC,iBAAO,EAAE,OAA3B;AAAoCC,iBAAO,EAAE;AAA7C,SADS,CADF;AAIPJ,iBAAS,EAAE,CACX;AAAEE,kBAAQ,EAAE,IAAZ;AAAkBC,iBAAO,EAAE,SAA3B;AAAsCC,iBAAO,EAAE;AAA/C,SADW;AAJJ,OAPgB;AAevBC,eAAS,EAAE,YAfY;AAgBvBC,kBAAY,EAAE;AACdC,mBAAW,EAAE,EADC;AAEdC,mBAAW,EAAE,EAFC;AAGdC,uBAAe,EAAE;AAHH,OAhBS;AAqBvBC,mBAAa,EAAE;AACfH,mBAAW,EAAE,CACb;AAAEL,kBAAQ,EAAE,IAAZ;AAAkBC,iBAAO,EAAE,QAA3B;AAAqCC,iBAAO,EAAE;AAA9C,SADa,CADE;AAIfI,mBAAW,EAAE,CACb;AAAEN,kBAAQ,EAAE,IAAZ;AAAkBC,iBAAO,EAAE,QAA3B;AAAqCC,iBAAO,EAAE;AAA9C,SADa,EAEb;AAAEO,aAAG,EAAE,CAAP;AAAUC,aAAG,EAAE,EAAf;AAAmBT,iBAAO,EAAE,cAA5B;AAA4CC,iBAAO,EAAE;AAArD,SAFa,CAJE;AAQfK,uBAAe,EAAE,CACjB;AAAEP,kBAAQ,EAAE,IAAZ;AAAkBC,iBAAO,EAAE,QAA3B;AAAqCC,iBAAO,EAAE;AAA9C,SADiB,EAEjB;AACAS,mBAAS,EAAE,CAACC,IAAD,EAAOC,KAAP,EAAcC,QAAd,KAA2B;AACtC,gBAAID,KAAI,KAAMnB,KAAK,CAACU,YAAN,CAAmBE,WAAjC,EAA8C;AAC9CQ,sBAAQ,CAAC,IAAIC,KAAJ,CAAU,WAAV,CAAD,CAAR;AACA,aAFA,MAEO;AACPD,sBAAQ;AACR;AACC,WAPD;AAQAZ,iBAAO,EAAE;AART,SAFiB;AARF;AArBQ,KAAD,CAAtB;;AA6CE,UAAMc,YAAW,GAAI,YAAY;AAC/B,UAAI;AACF,cAAMC,QAAO,GAAI,MAAMpC,KAAK,CAACqC,GAAN,CAAU,UAAV,CAAvB;AACA,cAAMC,IAAG,GAAIF,QAAQ,CAACE,IAAtB;AACAzB,aAAK,CAACE,QAAN,CAAeD,QAAf,GAA0BwB,IAAI,CAACxB,QAA/B;AACAD,aAAK,CAACC,QAAN,GAAiBwB,IAAI,CAACxB,QAAtB;AACAD,aAAK,CAACE,QAAN,CAAeC,OAAf,GAAyBsB,IAAI,CAACtB,OAA9B;AACAH,aAAK,CAACE,QAAN,CAAeE,SAAf,GAA2BqB,IAAI,CAACrB,SAAhC;AACF,OAPA,CAOE,OAAOsB,GAAP,EAAY;AACZC,eAAO,CAACC,GAAR,CAAYF,GAAZ;AACF;AACD,KAXD;;AAaAxC,aAAS,CAAC,MAAM;AACdoC,kBAAY;AACb,KAFQ,CAAT,CA3DM,CA+DN;;AACA,UAAMO,cAAa,GAAI,MAAM;AAC3B,YAAMC,IAAG,GAAI9B,KAAK,CAAC+B,KAAN,CAAYC,YAAzB;AACAF,UAAI,CAACG,QAAL,CAAc,MAAMC,KAAN,IAAe;AAC3B,YAAIA,KAAJ,EAAW;AACT,cAAI;AACF,kBAAMX,QAAO,GAAI,MAAMpC,KAAK,CAACgD,GAAN,CAAU,iBAAV,EAA6BnC,KAAK,CAACE,QAAnC,CAAvB;AACAyB,mBAAO,CAACC,GAAR,CAAYL,QAAZ;AACA3B,qBAAS,CAACwC,OAAV,CAAkB,MAAlB;AACF,WAJA,CAIE,OAAOC,KAAP,EAAc;AACdzC,qBAAS,CAACyC,KAAV,CAAgB,UAAUA,KAAK,CAAC9B,OAAhC;AACF;AACF;AACD,OAVD;AAWF,KAbA,CAhEM,CA+EN;;;AACA,UAAM+B,cAAa,GAAI,MAAM;AAC3B,YAAMR,IAAG,GAAI9B,KAAK,CAAC+B,KAAN,CAAYrB,YAAzB;AACAoB,UAAI,CAACG,QAAL,CAAc,MAAMC,KAAN,IAAe;AAC3B,YAAIA,KAAJ,EAAW;AACT,cAAI;AACF,kBAAMX,QAAO,GAAI,MAAMpC,KAAK,CAACoD,IAAN,CAAW,iBAAX,EAA8BvC,KAAK,CAACU,YAApC,CAAvB;AACAiB,mBAAO,CAACC,GAAR,CAAYL,QAAZ;AACA3B,qBAAS,CAACwC,OAAV,CAAkB,MAAlB;AACF,WAJA,CAIE,OAAOC,KAAP,EAAc;AACdzC,qBAAS,CAACyC,KAAV,CAAgB,UAAUA,KAAK,CAAC9B,OAAhC;AACF;AACF;AACD,OAVD;AAWF,KAbA;;AAeA,WAAO,EACL,GAAGtB,MAAM,CAACe,KAAD,CADJ;AAEL6B,oBAFK;AAGLS;AAHK,KAAP;AAKF;;AAhHe,CAAf","names":["reactive","toRefs","onMounted","axios","Header","ElTabs","ElTabPane","ElForm","ElFormItem","ElInput","ElButton","ElCard","ElMessage","name","components","setup","state","username","userInfo","address","telephone","rules","required","message","trigger","activeTab","passwordForm","oldPassword","newPassword","confirmPassword","passwordRules","min","max","validator","rule","value","callback","Error","initUserInfo","response","get","data","err","console","log","updateUserInfo","form","$refs","userInfoForm","validate","valid","put","success","error","changePassword","post"],"sourceRoot":"","sources":["D:\\Dev\\Front\\demo01\\src\\views\\User\\personal.vue"],"sourcesContent":["<template>\r\n    <div class=\"header\">\r\n    <Header></Header>\r\n    </div>\r\n    <div class=\"personal-center\">\r\n    <el-card shadow=\"hover\">\r\n    <div slot=\"header\" class=\"card-header\">\r\n    <h3>{{ userInfo.username }} 的个人中心</h3>\r\n    </div>\r\n    <div class=\"card-content\">\r\n    <el-tabs v-model=\"activeTab\" type=\"border-card\">\r\n    <el-tab-pane label=\"基本信息\" name=\"basic-info\">\r\n    <el-form :model=\"userInfo\" :rules=\"rules\" ref=\"userInfoForm\" label-width=\"120px\">\r\n    <el-form-item label=\"用户名\" prop=\"username\">\r\n    <el-input v-model=\"userInfo.username\" disabled></el-input>\r\n    </el-form-item>\r\n    <el-form-item label=\"地址\" prop=\"address\">\r\n    <el-input v-model=\"userInfo.address\"></el-input>\r\n    </el-form-item>\r\n    <el-form-item label=\"手机号\" prop=\"phone\">\r\n    <el-input v-model=\"userInfo.telephone\"></el-input>\r\n    </el-form-item>\r\n    <el-form-item>\r\n    <el-button type=\"primary\" @click=\"updateUserInfo\">保存</el-button>\r\n    </el-form-item>\r\n    </el-form>\r\n    </el-tab-pane>\r\n    <el-tab-pane label=\"修改密码\" name=\"change-password\">\r\n    <el-form :model=\"passwordForm\" :rules=\"passwordRules\" ref=\"passwordForm\" label-width=\"120px\">\r\n    <el-form-item label=\"旧密码\" prop=\"oldPassword\">\r\n    <el-input type=\"password\" v-model=\"passwordForm.oldPassword\"></el-input>\r\n    </el-form-item>\r\n    <el-form-item label=\"新密码\" prop=\"newPassword\">\r\n    <el-input type=\"password\" v-model=\"passwordForm.newPassword\"></el-input>\r\n    </el-form-item>\r\n    <el-form-item label=\"确认密码\" prop=\"confirmPassword\">\r\n    <el-input type=\"password\" v-model=\"passwordForm.confirmPassword\"></el-input>\r\n    </el-form-item>\r\n    <el-form-item>\r\n    <el-button type=\"primary\" @click=\"changePassword\">修改密码</el-button>\r\n    </el-form-item>\r\n    </el-form>\r\n    </el-tab-pane>\r\n    </el-tabs>\r\n    </div>\r\n    </el-card>\r\n    </div>\r\n    </template>\r\n    \r\n    <script>\r\n    import { reactive, toRefs, onMounted } from 'vue'\r\n    import axios from 'axios'\r\n    import Header from '../userLayout/Header/header.vue'\r\n    import { ElTabs, ElTabPane, ElForm, ElFormItem, ElInput, ElButton, ElCard, ElMessage } from 'element-plus'\r\n    \r\n    export default {\r\n    name: 'PersonalCenter',\r\n    components: {\r\n    Header,\r\n    ElTabs,\r\n    ElTabPane,\r\n    ElForm,\r\n    ElFormItem,\r\n    ElInput,\r\n    ElButton,\r\n    ElCard\r\n    },\r\n    setup() {\r\n    const state = reactive({\r\n    username: \"\",\r\n    userInfo: {\r\n    username: \"\",\r\n    address: \"\",\r\n    telephone: \"\"\r\n    },\r\n    rules: {\r\n    address: [\r\n    { required: true, message: '请输入地址', trigger: 'blur' },\r\n    ],\r\n    telephone: [\r\n    { required: true, message: '请输入电话号码', trigger: 'blur' },\r\n    ]\r\n    },\r\n    activeTab: \"basic-info\",\r\n    passwordForm: {\r\n    oldPassword: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\"\r\n    },\r\n    passwordRules: {\r\n    oldPassword: [\r\n    { required: true, message: '请输入旧密码', trigger: 'blur' }\r\n    ],\r\n    newPassword: [\r\n    { required: true, message: '请输入新密码', trigger: 'blur' },\r\n    { min: 6, max: 20, message: '密码长度为6-20个字符', trigger: 'blur' }\r\n    ],\r\n    confirmPassword: [\r\n    { required: true, message: '请确认新密码', trigger: 'blur' },\r\n    {\r\n    validator: (rule, value, callback) => {\r\n    if (value !== state.passwordForm.newPassword) {\r\n    callback(new Error('两次密码输入不一致'))\r\n    } else {\r\n    callback()\r\n    }\r\n    },\r\n    trigger: 'blur'\r\n    }\r\n    ]\r\n    }\r\n    });\r\n    \r\n      const initUserInfo = async () => {\r\n        try {\r\n          const response = await axios.get(\"/profile\");\r\n          const data = response.data;\r\n          state.userInfo.username = data.username;\r\n          state.username = data.username;\r\n          state.userInfo.address = data.address;\r\n          state.userInfo.telephone = data.telephone;\r\n        } catch (err) {\r\n          console.log(err);\r\n        }\r\n      };\r\n    \r\n      onMounted(() => {\r\n        initUserInfo();\r\n      });\r\n    \r\n      // 更新用户信息方法\r\n      const updateUserInfo = () => {\r\n        const form = state.$refs.userInfoForm;\r\n        form.validate(async valid => {\r\n          if (valid) {\r\n            try {\r\n              const response = await axios.put(\"/updateUserInfo\", state.userInfo);\r\n              console.log(response)\r\n              ElMessage.success('修改成功')\r\n            } catch (error) {\r\n              ElMessage.error('修改失败：' + error.message)\r\n            }\r\n          }\r\n        })\r\n      }\r\n    \r\n      // 修改密码方法\r\n      const changePassword = () => {\r\n        const form = state.$refs.passwordForm;\r\n        form.validate(async valid => {\r\n          if (valid) {\r\n            try {\r\n              const response = await axios.post(\"/changePassword\", state.passwordForm);\r\n              console.log(response)\r\n              ElMessage.success('修改成功')\r\n            } catch (error) {\r\n              ElMessage.error('修改失败：' + error.message)\r\n            }\r\n          }\r\n        })\r\n      }\r\n    \r\n      return {\r\n        ...toRefs(state),\r\n        updateUserInfo,\r\n        changePassword\r\n      }\r\n    }\r\n    }\r\n    </script>\r\n    \r\n    <style scoped>\r\n    .personal-center {\r\n    margin: 20px auto;\r\n    max-width: 800px;\r\n    margin-top:100px;\r\n    }\r\n    \r\n    .card-header {\r\n    background-color: #f5f7fa;\r\n    padding: 12px 20px;\r\n    }\r\n    \r\n    .card-content {\r\n    padding: 20px;\r\n    }\r\n    </style>"]},"metadata":{},"sourceType":"module"}